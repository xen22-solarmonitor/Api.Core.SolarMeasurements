<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>netstandard2.0</TargetFramework>
  </PropertyGroup>

  <PropertyGroup>
    <IncludeSymbols>true</IncludeSymbols>
    <SymbolPackageFormat>snupkg</SymbolPackageFormat>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Rest.ClientRuntime" Version="2.3.21" />
    <PackageReference Include="Microsoft.SourceLink.GitHub" Version="1.0.0" PrivateAssets="All"/>
  </ItemGroup>

  <!-- Dependency on main API project for build order only -->
  <ItemGroup>
    <ProjectReference Include="../Api.Core.SolarMeasurements/Api.Core.SolarMeasurements.csproj"
                      ReferenceOutputAssembly="false"
                      SkipGetTargetFrameworkProperties="true" >

      <AssetTargetFallback>netcoreapp3.1</AssetTargetFallback>
      <ReferenceOutputAssembly>false</ReferenceOutputAssembly>
   </ProjectReference> 
  </ItemGroup>

  <ItemGroup>
    <Folder Include="AutoGeneratedSwaggerDefinition" />
  </ItemGroup>

  <Target Name="GenerateProxyClasses" 
    BeforeTargets="PreBuildEvent"
    Inputs="AutoGeneratedSwaggerDefinition/swagger.json"
    Outputs="$(OutputPath)/$(AssemblyName).dll" >

    <Exec Command="echo Installing npm packages needed by autorest." />
    <Exec Command="npm install" />
    <Exec Command="echo Executing autorest." />
    <!-- <Exec Command="npx autorest autorest.md - -namespace=Api.Core.SolarMeasurementsProxy - -add-credentials - -input-file=AutoGeneratedSwaggerDefinition/swagger.json - -output-folder=AutoGeneratedProxyClasses - -csharp" /> -->
    <Exec Command="npx autorest autorest.md --namespace=Api.Core.SolarMeasurementsProxy --input-file=AutoGeneratedSwaggerDefinition/swagger.json --output-folder=AutoGeneratedProxyClasses --csharp" />
  </Target> 

</Project>
